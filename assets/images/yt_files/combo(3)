!function(){"use strict";var e=window.YAHOO||{},c=e.SP||{};function t(){}t.init=function(e){return c.create(c.WaldoLoggingPC,null,e)},t.prototype={initializer:function(){var t=this;e.Event.on("successGetBeacon",function(e){t.sendSuccessBeacon(e.detail)},t),e.Event.on("failedGetBeacon",function(e){t.sendErrorBeacon(e.detail)},t),e.Event.on("successAutoUpdateGeoLocation",function(e){t.sendSuccessBeacon(e.detail)},t),e.Event.on("failedAutoUpdateGeoLocation",function(e){t.sendErrorBeacon(e.detail)},t),e.Event.on("clickBeacon",function(e){t.clickBeacon(e.detail)},t),e.Event.on("viewBeacon",function(e){t.viewBeacon(e.detail)},t)},sendSuccessBeacon:function(e){var t=this,c=t.setupSharedBeaconData(),n=e.pos;c.lat=n.latitude,c["long"]=n.longitude,c.radius=n.accuracy,c.success=1,c.prd="locdet",c=t.setBeaconFieldT1(c,e),t.fireViewBeacon(c)},sendErrorBeacon:function(e){var t=this,c=t.setupSharedBeaconData(),n=e.err;c.success=0,c.locRqerr=n.code,c.prd="locdet",c=t.setBeaconFieldT1(c,e),t.fireViewBeacon(c)},setupSharedBeaconData:function(){return{s:c.ULT.get("spaceid"),srcpvid:c.ULT.get("pvid"),vtestid:c.ULT.get("testid"),rqstTrgr:"actn",t2:"prcsLoc",slk:"prcsLoc"}},setBeaconFieldT1:function(e,t){switch(t.uiSource||null){case"banner":e.t1="hdr",e.sec="header";break;case"local":e.sec="sc",e.it="LocalPc-listings",e.t2="LocalPc-listings",e.rspns="rsbmt";break;case"footer":e.t1="ftr",e.sec="footer";break;case"auto_update":e.rqstTrgr="backEnd",delete e.t2,delete e.slk}return isNaN(t.aqstnTme)||(e.aqstnTme=t.aqstnTme),e},viewBeacon:function(e){var t={s:c.ULT.get("spaceid"),csrcpvid:c.ULT.get("pvid"),vtestid:c.ULT.get("testid"),slk:"prcsLoc"};"update"==e.action&&(t.t3="getLoc",t.rspns="rsbmt"),t=this.setBeaconFieldT1(t,e),this.fireViewBeacon(t)},clickBeacon:function(e){var t;"string"==typeof e.beaconUrl&&e.beaconUrl?(new Image).src=e.beaconUrl:(t={_I:c.ULT.get("pvid"),vtestid:c.ULT.get("testid")},"update"==e.action&&(t.t3="getLoc",t.rspns="rsbmt"),"footer"==e.uiSource&&(t=this.setupFooterBeacon(t)),this.fireClickBeacon(t))},setupFooterBeacon:function(e){return e.sec="locStatus",e.t1pos="CBottom",e.t2="locStatus",e.actn="clk",e},fireClickBeacon:function(e){c.ULT.beacon(e)},fireViewBeacon:function(e){e.t=(new Date).getTime(),c.ULT.view_beacon(e)}},c.WaldoLoggingPC=t}();!function(r){"use strict";var c=r.YAHOO||{},n=c.SP||{},a="Waldo",t="ach",u="requireGeoLocationWriteBack",s=null;function e(){}e.ATTRS={geoLocationOptions:{value:{timeout:3e4,maximumAge:15e3,enableHighAccuracy:!1}}},e.init=function(e){return n.WaldoLoggingPC.init(e),n.WaldoWriteback.init(e),c.Waldo=n.create(n.WaldoBasePC,null,e),c.Waldo},e.prototype={initializer:function(){var e=this;c.Event.on("prompt",e._prompt.bind(e),e),c.Event.on("autoupdate",e._backgroundUpdate.bind(e),e)},checkCookieVersion:function(){var e,t=this;t._isValid==undefined&&(e=t.getCookieOptions(),2!=n.Cookie.getSub(a,"v",Number)&&n.Cookie.setSubs(a,{v:2},e),t._isValid=!0)},getCookieOptions:function(){var e={path:"/",domain:".search.yahoo.com"},t=new Date;return t.setTime(t.getTime()+6048e5),e.expires=t,e},getSub:function(e){return this.checkCookieVersion(),n.Cookie.getSub(a,e,Number)},addSub:function(e,t){var o=new Date,i=this.getCookieOptions(),t=Math.floor(o.getTime()/1e3)+t;this.checkCookieVersion(),n.Cookie.setSub(a,e,t,i),n.Cookie.setSub(a,"upd",1,i)},removeSub:function(e){var t=this.getCookieOptions();this.checkCookieVersion(),n.Cookie.removeSub(a,e,t)},isSubValid:function(e){var t=this.getSub(e),e=new Date;return t&&t>e.getTime()/1e3},_prompt:function(e){var t,o=this,i=o.get("geoLocationOptions"),n=e.uiSource,a=r.navigator.geolocation.getCurrentPosition;e.queryRewrite&&(s=e.queryRewrite),t="function"!=typeof r.performance.now?r.performance.now():null,a.call(r.navigator.geolocation,function(e){o.successGetThenReload.call(o,e,n,t)},function(e){o.failedGet.call(o,e,n,t)},i)},getAqstnTme:function(e){var t,o=null;return e&&(t=r.performance.now(),o=Math.floor(t-e)),o},successGetThenReload:function(e,t,o){var i=this.getAqstnTme(o),n=e.coords.latitude,a=e.coords.longitude,o=e.coords.accuracy;this.triggerAutoUpdate(),c.Event.fire("successGetBeacon",{pos:e.coords,uiSource:t,aqstnTme:i}),c.Event.fire(u,{lat:n,lon:a,radius:o,callback:this.pageReload,context:e})},failedGet:function(e,t,o){o=this.getAqstnTme(o);this.exitAutoUpdate(e),c.Event.fire("failedGet",{err:e}),c.Event.fire("failedGetBeacon",{err:e,uiSource:t,aqstnTme:o})},pageReload:function(e){var t=new URLSearchParams(r.location.search.substr(1)),e=e.coords;t.set("locupdate",1),t.set("lat",e.latitude),t.set("lon",e.longitude),t.set("radius",e.accuracy),t.set("fr2","p:s,v:w,m:loc"),s&&t.set("p",s),t=r.location.pathname+"?"+t.toString(),r.location.href=t},triggerAutoUpdate:function(){this.isSubValid(t)||this.addSub(t,31536e4)},exitAutoUpdate:function(e){e.code==e.PERMISSION_DENIED&&(this.removeSub("ao"),this.removeSub(t))},_backgroundUpdate:function(e){var t=this,o=t.get("geoLocationOptions"),i=e.uiSource,e=r.navigator.geolocation.getCurrentPosition,n="function"==typeof r.performance.now?r.performance.now():null;e.call(r.navigator.geolocation,function(e){t.successGetNoReload.call(t,e,i,n)},function(e){t.failedGetAndExitAutoUpdate.call(t,e,i,n)},o)},successGetNoReload:function(e,t,o){var i=this.getAqstnTme(o),n=e.coords.latitude,a=e.coords.longitude,o=e.coords.accuracy;c.Event.fire("successAutoUpdateGeoLocation",{pos:e.coords,uiSource:"auto_update",aqstnTme:i}),c.Event.fire(u,{lat:n,lon:a,radius:o})},failedGetAndExitAutoUpdate:function(e,t,o){o=this.getAqstnTme(o);c.Event.fire("failedAutoUpdateGeoLocation",{err:e,uiSource:"auto_update",aqstnTme:o}),this.exitAutoUpdate(e)}},n.WaldoBasePC=e}(window);!function(){"use strict";var s=window.YAHOO||{},i=s.NB||{},e=s.SP||{},n="",a="update",o="prompt",u="activeIconClass";function t(){}t.ATTRS={host:{setter:s.one,writeOnce:"initOnly"},fireViewBeacon:{value:!1,writeOnce:"initOnly"},fireClickBeacon:{value:!0,writeOnce:"initOnly"},activeIconClass:{value:"location-icon"},inactiveIconClass:{value:"location-icon-inactive"}},t.prototype={initializer:function(){var e=this,t=e.get("host");t?(e.has("uiSource")&&(n=e.get("uiSource")),e.set("_updateBtn",t.querySelector(".update")),e.set("_address",t.querySelector(".addr")),e.set("_loc_active",t.querySelector(".location-active")),e.set("_loc_icon",t.querySelector("."+e.get(u))),e.set("_loc_reported",t.querySelector(".reported")),e.get("fireViewBeacon")&&s.Event.fire("viewBeacon",{uiSource:n,action:a}),e.bindEvent()):i.debug("No binding Node specified.")},bindEvent:function(){var e=this,t=e.get("_updateBtn");t&&s.Event.on("click",e._ClickUpdate.bind(e),t),s.Event.on(o,e._promptText.bind(e)),s.Event.on("failedGet",e._failGetText.bind(e))},_ClickUpdate:function(e){var t=null,i=e.currentTarget;e.preventDefault(),s.DOM.hasClass(this.get("_updateBtn"),"executing")||(i&&i.hasAttribute("href")&&""!==i.getAttribute("href")&&(t=i.getAttribute("href")),this.get("fireClickBeacon")&&s.Event.fire("clickBeacon",{beaconUrl:t,uiSource:n,action:a}),s.Event.fire(o,{uiSource:n}))},_promptText:function(){var e=s.i18n.get("waldo"),t=this.get("_updateBtn");s.DOM.hasClass(t,"ghstxt")?t.setAttribute("title",e.location_text_detecting):t.innerText=e.location_text_detecting||"",s.DOM.addClass(t,"executing"),s.DOM.addClass(t.parentElement,"loc-executing")},_failGetText:function(e){var t=this,i=t.get("_dot"),n=s.i18n.get("waldo"),a=t.get("_updateBtn"),o=t.get("_address"),c=t.get("_loc_active"),l=t.get("_loc_icon"),r=t.get("_loc_reported");i&&(s.DOM.removeClass(i,["high","medium"]),s.DOM.addClass(i,"low")),r&&!s.DOM.hasClass(r,"ghstxt")?r.innerText=n.location_text_unavailable:(r&&r.setAttribute("title",n.location_text_unavailable),a&&a.setAttribute("title",n.location_text_unavailable)),o&&s.DOM.addClass(o,"d-n"),e&&e.err&&3===e.err.code&&(s.DOM.hasClass(a,"ghstxt")?a.setAttribute("title",n.location_detect_again):a.innerText=n.location_detect_again),s.DOM.removeClass(a,"executing"),s.DOM.removeClass(a.parentElement,"loc-executing"),c&&s.DOM.replaceClass(c,"location-active","location-inactive"),l&&s.DOM.replaceClass(l,t.get(u),t.get("inactiveIconClass"))}},e.WaldoUI=t}();!function(t,r){"use strict";var u=t.YAHOO||{},e=u.SP||{};function c(){}c.init=function(t){return e.create(e.WaldoWriteback,null,t)},c.prototype={crumb:null,cfg:null,initializer:function(){var e=this,t=r.querySelector("#location");t&&(e.crumb=t.dataset.crumb),e.crumb||(e.crumb=e.get("crumb")),u.Event.on("requireGeoLocationWriteBack",function(t){e.cfg=t.detail,e.sgsPurge()}.bind(e))},afterUpdate:function(){var t=this.cfg;t.callback&&t.callback(t.context)},locUpdate:function(){var t=this,e="/locupdate",r=t.cfg,c=r.lat+";"+r.lon;t.crumb&&(e+="?crumb="+t.crumb),r.radius&&(c+=" epu="+r.radius),u.AjaxHelper.xhr(e,t.afterUpdate.bind(t),{timeout:1e3,headers:{"Geo-Position":c}})},sgsPurge:function(){var t=this,e="/sgspurge";t.crumb&&(e+="?crumb="+t.crumb),u.AjaxHelper.xhr(e,t.locUpdate.bind(t),{timeout:1e3})}},e.WaldoWriteback=c}(window,document);